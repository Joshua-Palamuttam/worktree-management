@echo off
echo Setting up worktree commands for this machine...
echo.

REM Find Git Bash
set "GIT_BASH="
if exist "C:\Program Files\Git\bin\bash.exe" (
    set "GIT_BASH=C:\Program Files\Git\bin\bash.exe"
) else if exist "C:\Program Files (x86)\Git\bin\bash.exe" (
    set "GIT_BASH=C:\Program Files (x86)\Git\bin\bash.exe"
) else (
    for /f "delims=" %%i in ('where git 2^>nul') do (
        set "GIT_PATH=%%~dpi"
        if exist "!GIT_PATH!..\bin\bash.exe" set "GIT_BASH=!GIT_PATH!..\bin\bash.exe"
    )
)

if "%GIT_BASH%"=="" (
    echo ERROR: Could not find Git Bash. Please install Git for Windows.
    exit /b 1
)

echo Found Git Bash: %GIT_BASH%

set "SCRIPT_DIR=%~dp0..\scripts"
for %%I in ("%SCRIPT_DIR%") do set "SCRIPT_DIR=%%~fI"
set "SCRIPT_DIR=%SCRIPT_DIR:\=/%"
set "SCRIPT_DIR=%SCRIPT_DIR:C:/=/c/%"
set "SCRIPT_DIR=%SCRIPT_DIR:D:/=/d/%"

set "WT_ROOT=%~dp0..\.."
for %%I in ("%WT_ROOT%") do set "WT_ROOT=%%~fI"

echo Creating config file...
(
echo @echo off
echo REM Worktree Management Config - Machine Specific
echo REM Generated by setup.cmd - DO NOT COMMIT
echo set "GIT_BASH=%GIT_BASH%"
echo set "SCRIPTS_PATH=%SCRIPT_DIR%"
echo set "WORKTREE_ROOT=%WT_ROOT%"
) > "%~dp0wt-config.cmd"

echo.
echo ========================================
echo Setup complete!
echo ========================================
echo.
echo Config file created: %~dp0wt-config.cmd
echo Git Bash: %GIT_BASH%
echo Scripts path: %SCRIPT_DIR%
echo Worktree root: %WT_ROOT%
echo.
echo Make sure this is in your PATH:
echo   %~dp0
echo.
